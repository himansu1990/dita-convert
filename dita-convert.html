<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Professional DITA Studio - Layout Design</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* ---------- Global Styles ---------- */
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; }
h1,h2,h3 { margin:10px 0; }
p { line-height:1.6; margin:6px 0; }
button { margin:2px; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; }
button:hover { opacity:0.9; }

/* ---------- Header ---------- */
header { background:#4CAF50; color:#fff; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; position:fixed; top:0; left:0; right:0; z-index:1000; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
header h1 { font-size:20px; margin:0; }
header nav button { background:#fff; color:#4CAF50; margin-left:5px; }
header nav button:hover { background:#e0e0e0; }

/* ---------- Footer ---------- */
footer { background:#4CAF50; color:#fff; text-align:center; padding:10px; position:fixed; bottom:0; left:0; right:0; }

/* ---------- Main Content ---------- */
main { margin:80px 20px 60px; } /* leave space for header/footer */
section { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
section h2 { margin-top:0; }

/* ---------- Editor Layout ---------- */
.editor-container { display:flex; flex-wrap:wrap; gap:20px; }
#advancedEditor { flex:1 1 45%; height:400px; border:1px solid #ccc; padding:10px; overflow:auto; background:#fff; border-radius:6px; }
#advancedDITA { flex:1 1 45%; height:400px; padding:10px; font-family:monospace; resize:none; border-radius:6px; border:1px solid #ccc; background:#f9f9f9; }

/* ---------- Toolbar ---------- */
.toolbar button { background:#eee; color:#333; margin-right:4px; }
.toolbar button:hover { background:#ddd; }

/* ---------- Content Styles ---------- */
.note { display:block; background:#fff8d1; border-left:6px solid #f4c430; padding:10px; margin:10px 0; font-style:italic; border-radius:4px; }
.codeblock, pre { display:block; background:#272822; color:#f8f8f2; padding:10px; overflow-x:auto; border-radius:4px; font-family:monospace; white-space:pre-wrap; margin:10px 0; }
img { max-width:100%; margin:10px 0; border-radius:4px; }
</style>
</head>
<body>

<!-- ---------- Header ---------- -->
<header>
  <h1>Professional DITA Studio</h1>
  <nav>
    <button onclick="downloadPDF('advancedEditor','advanced-dita.pdf')"><i class="fa fa-file-pdf"></i> PDF</button>
    <button onclick="downloadAdvancedDITA()"><i class="fa fa-file-code"></i> DITA XML</button>
  </nav>
</header>

<main>
  <!-- ---------- Rich Text Editor Section ---------- -->
  <section>
    <h2>Rich Text Editor â†’ DITA XML</h2>
    <div class="toolbar">
      <button onclick="format('h1')"><i class="fa fa-heading"></i> H1</button>
      <button onclick="format('h2')"><i class="fa fa-heading"></i> H2</button>
      <button onclick="format('h3')"><i class="fa fa-heading"></i> H3</button>
      <button onclick="format('bold')"><i class="fa fa-bold"></i></button>
      <button onclick="format('italic')"><i class="fa fa-italic"></i></button>
      <button onclick="format('underline')"><i class="fa fa-underline"></i></button>
      <button onclick="format('p')">P</button>
      <button onclick="insertNote()">Note</button>
      <button onclick="insertCode()">Code</button>
      <button onclick="insertImage()">Image</button>
      <button onclick="insertUL()">UL</button>
      <button onclick="insertOL()">OL</button>
    </div>
    <div class="editor-container">
      <div id="advancedEditor" contenteditable="true">
        <h1 data-node="title">Type Title Here</h1>
        <p data-node="p1">Type first paragraph...</p>
      </div>
      <textarea id="advancedDITA" readonly></textarea>
    </div>
  </section>
</main>

<!-- ---------- Footer ---------- -->
<footer>
  &copy; 2025 Professional DITA Studio. All rights reserved.
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script>
// ---------- Toolbar Functions ----------
const advEditor=document.getElementById("advancedEditor");
const advDITA=document.getElementById("advancedDITA");

function format(command){ 
    if(command.startsWith('h')) document.execCommand('formatBlock',false,command); 
    else document.execCommand(command,false,null);
}

// ---------- Insert Dynamic Elements ----------
function insertNote(){ createElement('div','note','Type note here...','note'); }
function insertCode(){ createElement('pre','codeblock','Type code here...','codeblock'); }
function insertImage(){
    const url=prompt('Enter image URL:');
    if(url){
        fetch(url).then(r=>r.blob()).then(blob=>{
            const reader=new FileReader();
            reader.onloadend=function(){
                const img=document.createElement('img');
                img.src=reader.result; advEditor.appendChild(img); updateAdvancedDITA(); autosave();
            }
            reader.readAsDataURL(blob);
        }).catch(()=>alert("Unable to load image. Check URL/CORS."));
    }
}
function insertUL(){ const ul=document.createElement('ul'); const li=document.createElement('li'); li.textContent='List item'; ul.appendChild(li); advEditor.appendChild(ul); updateAdvancedDITA(); autosave();}
function insertOL(){ const ol=document.createElement('ol'); const li=document.createElement('li'); li.textContent='List item'; ol.appendChild(li); advEditor.appendChild(ol); updateAdvancedDITA(); autosave();}
function createElement(tag,className,text,nodeAttr){
    const el=document.createElement(tag);
    el.className=className; el.textContent=text; el.setAttribute('data-node',nodeAttr);
    advEditor.appendChild(el); updateAdvancedDITA(); autosave();
}

// ---------- Convert HTML to DITA ----------
function htmlToDITA(node){
    let dita=''; node.childNodes.forEach(child=>{
        if(child.nodeType===3 && child.textContent.trim()){ dita+=`<p>${child.textContent.trim()}</p>\n`; }
        else if(child.nodeType===1){
            switch(child.tagName.toLowerCase()){
                case 'h1': case 'h2': case 'h3': dita+=`<title>${child.textContent}</title>\n`; break;
                case 'p': dita+=`<p>${child.textContent}</p>\n`; break;
                case 'div': if(child.classList.contains('note')) dita+=`<note>${child.textContent}</note>\n`; else dita+=htmlToDITA(child); break;
                case 'pre': dita+=`<codeblock>${child.textContent}</codeblock>\n`; break;
                case 'img': dita+=`<image href="${child.src}" />\n`; break;
                case 'ul': dita+="<ul>\n"+Array.from(child.children).map(li=>`<li>${li.textContent}</li>`).join("\n")+"\n</ul>\n"; break;
                case 'ol': dita+="<ol>\n"+Array.from(child.children).map(li=>`<li>${li.textContent}</li>`).join("\n")+"\n</ol>\n"; break;
                default: dita+=htmlToDITA(child);
            }
        }
    });
    return dita;
}

function updateAdvancedDITA(){ advDITA.value=`<topic id="generated-topic">\n${htmlToDITA(advEditor)}\n</topic>`; }

// ---------- Download ----------
function downloadAdvancedDITA(){ const blob=new Blob([advDITA.value],{type:"text/xml"}); const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="advanced-dita.xml"; link.click(); }
function downloadPDF(elementId,filename){
    const element=document.getElementById(elementId);
    if(!element.innerHTML.trim()){ alert("No content to download."); return; }
    html2pdf().set({margin:[15,15,15,15],filename:filename,image:{type:'jpeg',quality:0.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}).from(element).save();
}

// ---------- Autosave ----------
function autosave(){ localStorage.setItem('ditaEditorContent',advEditor.innerHTML); }
window.addEventListener('load',()=>{ if(localStorage.getItem('ditaEditorContent')){ advEditor.innerHTML=localStorage.getItem('ditaEditorContent'); updateAdvancedDITA(); } });
advEditor.addEventListener('input',()=>{ updateAdvancedDITA(); autosave(); });

updateAdvancedDITA();
</script>

</body>
</html>
