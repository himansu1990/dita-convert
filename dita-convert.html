<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DITA XML Converter</title>
<style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    textarea { width: 100%; height: 200px; }
    #outputHTML { border: 1px solid #ccc; padding: 10px; margin-top: 10px; background: #fafafa; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
</style>
</head>
<body>
<h1>DITA XML to HTML & PDF Converter</h1>

<input type="file" id="fileInput" accept=".xml,.dita,.ditamap"><br><br>
<button id="downloadHTML" disabled>Download HTML</button>
<button id="downloadPDF" disabled>Download PDF</button>

<h2>HTML Preview</h2>
<div id="outputHTML"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let fileNameWithoutExt = "dita-output"; // Default if no file uploaded
let htmlContent = "";

document.getElementById("fileInput").addEventListener("change", function() {
    const file = this.files[0];
    if (!file) return;

    fileNameWithoutExt = file.name.replace(/\.[^/.]+$/, ""); // remove extension

    const reader = new FileReader();
    reader.onload = function(e) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(e.target.result, "text/xml");

        // Basic DITA to HTML conversion (can be expanded for better formatting)
        htmlContent = convertDitaToHtml(xmlDoc);

        document.getElementById("outputHTML").innerHTML = htmlContent;
        document.getElementById("downloadHTML").disabled = false;
        document.getElementById("downloadPDF").disabled = false;
    };
    reader.readAsText(file);
});

function convertDitaToHtml(xmlDoc) {
    let html = "";

    // Title
    const title = xmlDoc.getElementsByTagName("title")[0];
    if (title) html += `<h1>${title.textContent}</h1>`;

    // Paragraphs
    const paras = xmlDoc.getElementsByTagName("p");
    for (let p of paras) {
        html += `<p>${p.textContent}</p>`;
    }

    // Lists
    const lists = xmlDoc.getElementsByTagName("ul");
    for (let list of lists) {
        html += "<ul>";
        for (let li of list.getElementsByTagName("li")) {
            html += `<li>${li.textContent}</li>`;
        }
        html += "</ul>";
    }

    // Code blocks
    const codes = xmlDoc.getElementsByTagName("codeblock");
    for (let code of codes) {
        html += `<pre><code>${code.textContent}</code></pre>`;
    }

    return html;
}

document.getElementById("downloadHTML").addEventListener("click", function() {
    const blob = new Blob([htmlContent], { type: "text/html" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${fileNameWithoutExt}.html`;
    link.click();
});

document.getElementById("downloadPDF").addEventListener("click", function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.html(document.getElementById("outputHTML"), {
        callback: function (pdf) {
            pdf.save(`${fileNameWithoutExt}.pdf`);
        },
        x: 10,
        y: 10
    });
});
</script>
</body>
</html>
