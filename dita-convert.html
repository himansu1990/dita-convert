<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DITA Converter with Sidebar</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        height: 100vh;
    }

    /* Sidebar styling */
    #sidebar {
        width: 250px;
        background: #2f3542;
        color: white;
        overflow-y: auto;
        transition: width 0.3s;
    }
    #sidebar.collapsed {
        width: 0;
        overflow: hidden;
    }
    #sidebar h2 {
        padding: 15px;
        margin: 0;
        background: #1e272e;
        font-size: 16px;
    }
    #navList {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    #navList li {
        padding: 10px 20px;
        cursor: pointer;
        font-size: 14px;
    }
    #navList li:hover {
        background: #57606f;
    }

    /* Main content */
    #content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }

    /* Toggle button */
    #toggleSidebar {
        position: absolute;
        top: 10px;
        left: 260px;
        background: #2f3542;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        z-index: 1000;
    }
    #sidebar.collapsed + #toggleSidebar {
        left: 10px;
    }

    /* Headings style */
    h1, h2, h3 {
        margin-top: 30px;
    }
</style>
</head>
<body>

<div id="sidebar">
    <h2>Contents</h2>
    <ul id="navList"></ul>
</div>

<button id="toggleSidebar">â˜°</button>

<div id="content">
    <input type="file" id="fileInput"><br><br>
    <button id="downloadHTML">Download HTML</button>
    <button id="downloadPDF">Download PDF</button>
    <hr>
    <div id="output"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
document.getElementById('fileInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(event.target.result, "application/xml");
        const htmlContent = transformDITA(xmlDoc);
        document.getElementById("output").innerHTML = htmlContent;
        buildSidebar();
    };
    reader.readAsText(file);
});

function transformDITA(xmlDoc) {
    let html = "";
    const root = xmlDoc.documentElement;
    const title = root.getElementsByTagName("title")[0];
    if (title && root.tagName === "topic") {
        html += `<h1>${title.textContent}</h1>`;
    }
    let children = Array.from(root.children);
    if (children.length && children[0].tagName === "title") {
        children.shift();
    }
    html += parseDITAChildren(children, 2);
    return html;
}

function parseDITAChildren(children, level) {
    let html = "";
    children.forEach(child => {
        switch (child.tagName) {
            case "title":
                html += `<h${level}>${child.textContent}</h${level}>`;
                break;
            case "p":
                html += `<p>${child.textContent}</p>`;
                break;
            case "section":
                html += parseDITAChildren(Array.from(child.children), level + 1);
                break;
            case "note":
                html += `<div style="border-left: 4px solid orange; padding: 5px; background: #fff8e1;">${child.textContent}</div>`;
                break;
            case "codeblock":
                html += `<pre style="background:#1e1e1e; color:#dcdcdc; padding:10px; border-radius:5px;"><code>${child.textContent}</code></pre>`;
                break;
            case "table":
                html += new XMLSerializer().serializeToString(child);
                break;
            default:
                html += parseDITAChildren(Array.from(child.children), level);
        }
    });
    return html;
}

// Sidebar builder
function buildSidebar() {
    const navList = document.getElementById("navList");
    navList.innerHTML = "";
    const headings = document.querySelectorAll("#output h1, #output h2, #output h3");
    headings.forEach((heading, index) => {
        heading.id = "heading-" + index;
        const li = document.createElement("li");
        li.textContent = heading.textContent;
        li.addEventListener("click", () => {
            heading.scrollIntoView({ behavior: "smooth" });
        });
        navList.appendChild(li);
    });
}

// Sidebar toggle
document.getElementById("toggleSidebar").addEventListener("click", () => {
    document.getElementById("sidebar").classList.toggle("collapsed");
});

// Download HTML
document.getElementById("downloadHTML").addEventListener("click", () => {
    const content = document.getElementById("output").innerHTML;
    const blob = new Blob([content], { type: "text/html" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "dita-output.html";
    link.click();
});

// Download PDF
document.getElementById("downloadPDF").addEventListener("click", () => {
    const element = document.getElementById("output");
    html2pdf().from(element).save("dita-output.pdf");
});
</script>

</body>
</html>
