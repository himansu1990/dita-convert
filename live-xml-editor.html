<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live DITA Editor</title>
<style>
body { font-family: 'Times New Roman', serif; margin:0; padding:20px; background:#f7f7f7;}
h1,h2,h3,h4,h5 { color:#222; margin:10px 0;}
p { line-height:1.6; color:#333; margin:6px 0;}
.note { display:block; background:#fff8d1; border-left:6px solid #f4c430; padding:10px; margin:10px 0; font-style:italic;}
.codeblock, pre { display:block; background:#272822; color:#f8f8f2; padding:10px; overflow-x:auto; border-radius:4px; font-family:monospace; white-space:pre-wrap; margin:10px 0;}
table { border-collapse:collapse; margin:15px 0; width:100%; }
table, th, td { border:1px solid #888;}
th, td { padding:8px 12px; text-align:left; font-size:14px;}
img { max-width:100%; margin:10px 0;}
button { margin:5px 2px; padding:8px 12px; background:#4CAF50; color:#fff; border:none; cursor:pointer; border-radius:4px;}
button:hover { background:#45a049;}
.output-container { background:white; padding:20px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.2); width:100%; box-sizing:border-box; margin-top:20px;}
.editor-container { display:flex; gap:20px; margin-top:20px;}
textarea { width:50%; height:400px; padding:10px; font-family:monospace; resize:vertical;}
</style>
</head>
<body>
<!-- ---------- Live XML Editor ---------- -->
<h2>Live DITA Editor</h2>
<div class="editor-container">
    <textarea id="ditaTextarea" placeholder="Type or paste DITA XML here..."></textarea>
    <div id="liveOutput" class="output-container"></div>
</div>
<button onclick="downloadPDF('liveOutput','live-dita-output.pdf')">Download Live Output PDF</button>
<button onclick="downloadHTML('liveOutput','live-dita-output.html')">Download Live Output HTML</button>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script>
    function transformDITA(xmlDoc){
    let html="";
    const root = xmlDoc.documentElement;
    const title = root.getElementsByTagName("title")[0];
    if(title && root.tagName==="topic") html+=`<h1>${title.textContent}</h1>`;
    let children = Array.from(root.children);
    if(children.length && children[0].tagName==="title") children.shift();
    html+=parseDITAChildren(children,2);
    return html;
}

function parseDITAChildren(children, headingLevel){
    let html="";
    for(let child of children){
        switch(child.tagName){
            case "title": html+=`<h${headingLevel}>${child.textContent}</h${headingLevel}>`; break;
            case "p": html+=`<p>${child.textContent}</p>`; break;
            case "note": html+=`<div class="note">ðŸ’¡ ${child.textContent}</div>`; break;
            case "codeblock": html+=`<pre class="codeblock">${child.textContent}</pre>`; break;
            case "ul": html+="<ul>"+parseDITAChildren(child.children,headingLevel)+"</ul>"; break;
            case "ol": html+="<ol>"+parseDITAChildren(child.children,headingLevel)+"</ol>"; break;
            case "li": html+=`<li>${child.textContent}</li>`; break;
            case "section": html+=parseDITAChildren(child.children,headingLevel); break;
            case "table": html+="<table>"+parseDITAChildren(child.children,headingLevel)+"</table>"; break;
            case "tgroup": html+=parseDITAChildren(child.children,headingLevel); break;
            case "thead": html+="<thead>"+parseDITAChildren(child.children,headingLevel)+"</thead>"; break;
            case "tbody": html+="<tbody>"+parseDITAChildren(child.children,headingLevel)+"</tbody>"; break;
            case "row": html+="<tr>"+parseDITAChildren(child.children,headingLevel)+"</tr>"; break;
            case "entry": html+=`<td>${child.textContent}</td>`; break;
            case "image": const href=child.getAttribute("href")||""; html+=`<img src="${href}" alt="">`; break;
            default: html+=parseDITAChildren(child.children,headingLevel);
        }
    }
    return html;
}
// -------------------- PDF & HTML Download --------------------
function downloadPDF(elementId, filename){
    const element=document.getElementById(elementId);
    if(!element.innerHTML.trim()){ alert("No content to download."); return; }
    element.style.width="100%";
    html2pdf().set({
        margin:[15,15,15,15],
        filename:filename,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2,useCORS:true},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
    }).from(element).save().then(()=>{ element.style.width=""; });
}

function downloadHTML(elementId, filename){
    const element=document.getElementById(elementId);
    if(!element.innerHTML.trim()){ alert("No content to download."); return; }
    const blob=new Blob([element.innerHTML],{type:"text/html"});
    const link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download=filename;
    link.click();
}
    
  // -------------------- Live DITA Textarea --------------------
const textarea = document.getElementById("ditaTextarea");
const liveOutput = document.getElementById("liveOutput");
textarea.addEventListener("input",()=>{
    const xmlText = textarea.value.trim();
    if(!xmlText){ liveOutput.innerHTML=""; return; }
    try{
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText,"application/xml");
        if(xmlDoc.getElementsByTagName("parsererror").length){ liveOutput.innerHTML="<p style='color:red;'>Invalid XML</p>"; return; }
        liveOutput.innerHTML = transformDITA(xmlDoc);
    } catch{ liveOutput.innerHTML="<p style='color:red;'>Error parsing XML</p>"; }
});
</script>
  </body>
  </html>
